<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C_R角與刀鼻補正</title>
</head>
<body>
    <table>
        <thead>
            <tr>
                <th colspan="7">無補刀鼻-C&R角尺寸</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="2">第一圓&倒角</td>
                <td></td>
                <td colspan="2">第一點差值</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>起始Y</td>
                <td><input type="number" name="" id="start_y" style="width:60px" class="input_val"></td>
                <td></td>
                <td class="t_right">X1:</td>
                <td id="A_X1"></td>
                <td class="t_right">Y0:</td>
                <td id="A_Y0"></td>
            </tr>
            <tr>
                <td>D1直徑</td>
                <td><input type="number" name="" id="d1_diameter" style="width:60px" class="input_val"></td>
                <td></td>
                <td colspan="2">第二點差值</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>R1圓角</td>
                <td><input type="number" name="" id="r1_fillet" style="width:60px" class="input_val"></td>
                <td></td>
                <td class="t_right">X2:</td>
                <td id="A_X2"></td>
                <td class="t_right">Y1:</td>
                <td id="A_Y1"></td>
            </tr>
            <tr>
                <td>A1角度</td>
                <td><input type="number" name="" id="a1_angle" style="width:60px" class="input_val"></td>
                <td></td>
                <td colspan="2">第三點差值</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>D2直徑</td>
                <td><input type="number" name="" id="d2_diameter" style="width:60px" class="input_val"></td>
                <td></td>
                <td class="t_right">X3:</td>
                <td id="A_X3"></td>
                <td class="t_right">Y2:</td>
                <td id="A_Y2"></td>
            </tr>
            <tr>
                <td>R2圓角</td>
                <td><input type="number" name="" id="r2_fillet" style="width:60px" class="input_val"></td>
                <td></td>
                <td colspan="2">第四點差值</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>刀鼻半徑</td>
                <td><input type="number" name="" id="nose_radius" style="width:60px" class="input_val"></td>
                <td></td>
                <td class="t_right">X0:</td>
                <td id="A_X0"></td>
                <td class="t_right">Y3:</td>
                <td id="A_Y3"></td>
            </tr>
        </tbody>
    </table>
    <table>
        <thead>
            <tr>
                <th colspan="11">正角車削外徑</th>
            </tr>
            <tr>
                <th colspan="5">無補刀鼻半徑</th>
                <th colspan="6">補刀鼻半徑</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td class="t_right">弦長</td>
                <td id="B_arc"></td>
                <td class="t_right">X偏值</td>
                <td id="B_X_offset1"></td>
                <td class="t_right">Z偏值</td>
                <td id="B_Z_offset1"></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td class="t_right">輪廓偏移</td>
                <td id="B_contour_offset"></td>
                <td class="t_right">X偏值</td>
                <td id="B_X_offset2"></td>
                <td class="t_right">Z偏值</td>
                <td id="B_Z_offset2"></td>
            </tr>
            <tr>
                <td>第一點:</td>
                <td class="t_right">X:</td>
                <td id="B_1_nX"></td>
                <td class="t_right">Z:</td>
                <td id="B_1_nZ"></td>
                <td class="t_right">X:</td>
                <td id="B_1_oX"></td>
                <td class="t_right">Z:</td>
                <td id="B_1_oZ"></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>第二點:</td>
                <td class="t_right">X:</td>
                <td id="B_2_nX"></td>
                <td class="t_right">Z:</td>
                <td id="B_2_nZ"></td>
                <td class="t_right">X:</td>
                <td id="B_2_oX"></td>
                <td class="t_right">Z:</td>
                <td id="B_2_oZ"></td>
                <td class="t_right">R:</td>
                <td id="B_2_oR"></td>
            </tr>
            <tr>
                <td>第三點:</td>
                <td class="t_right">X:</td>
                <td id="B_3_nX"></td>
                <td class="t_right">Z:</td>
                <td id="B_3_nZ"></td>
                <td class="t_right">X:</td>
                <td id="B_3_oX"></td>
                <td class="t_right">Z:</td>
                <td id="B_3_oZ"></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>第四點:</td>
                <td class="t_right">X:</td>
                <td id="B_4_nX"></td>
                <td class="t_right">Z:</td>
                <td id="B_4_nZ"></td>
                <td class="t_right">X:</td>
                <td id="B_4_oX"></td>
                <td class="t_right">Z:</td>
                <td id="B_4_oZ"></td>
                <td class="t_right">R:</td>
                <td id="B_4_oR"></td>
            </tr>
        </tbody>
    </table>
    <table>
        <thead>
            <tr>
                <th colspan="11">負角切削外徑</th>
            </tr>
            <tr>
                <th colspan="5">無補刀鼻半徑</th>
                <th colspan="6">補刀鼻半徑</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>D1直徑</td>
                <td id="C_D1"></td>
                <td></td>
                <td>D2直徑</td>
                <td id="C_D2"></td>
                <td class="t_right">弦長</td>
                <td id="C_arc"></td>
                <td class="t_right">X偏值</td>
                <td id="C_X_offset"></td>
                <td class="t_right">Z偏值</td>
                <td id="C_Z_offset"></td>
            </tr>
            <tr>
                <td>L1</td>
                <td id="C_L1"></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>第一點:</td>
                <td class="t_right">X:</td>
                <td id="C_1_nX"></td>
                <td class="t_right">Z:</td>
                <td id="C_1_nZ"></td>
                <td class="t_right">X:</td>
                <td id="C_1_oX"></td>
                <td class="t_right">Z:</td>
                <td id="C_1_oZ"></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>第二點:</td>
                <td class="t_right">X:</td>
                <td id="C_2_nX"></td>
                <td class="t_right">Z:</td>
                <td id="C_2_nZ"></td>
                <td class="t_right">X:</td>
                <td id="C_2_oX"></td>
                <td class="t_right">Z:</td>
                <td id="C_2_oZ"></td>
                <td class="t_right">R:</td>
                <td id="C_2_oR"></td>
            </tr>
        </tbody>
    </table>
</body>
<style>
.t_right {
    text-align:right
}
.t_left {
    text-align:left
}
table, th, td {
  border: 1px solid black;
}
th, td {
    min-width: 60px;
}
</style>
<script>
    // 創建新的圖片元素
var image = new Image();

// 圖片 Base64 字串
var base64Image = ""; //

// 當圖片加載完成後執行回調函式
image.onload = function() {
  // 創建 canvas 元素
  var canvas = document.createElement('canvas');
  canvas.width = image.width;
  canvas.height = image.height;

  // 獲取 2D 上下文
  var context = canvas.getContext('2d');

  // 在 canvas 上繪製圖片
  context.drawImage(image, 0, 0);

  // 寫上文字
  context.font = '20px Arial';
  context.fillStyle = 'red';
  context.fillText('Hello, World!', 50, 50);

  // 將 canvas 轉換為圖片 Base64 字串
  var modifiedImage = canvas.toDataURL();

  // 將圖片顯示在頁面上
  var imgElement = document.createElement('img');
  imgElement.src = modifiedImage;
//   document.body.appendChild(imgElement);
};

// 設置圖片元素的 src 屬性為 Base64 字串
image.src = base64Image;


document.addEventListener("DOMContentLoaded", function(){
  // Handler when the DOM is fully loaded
}); 

// document.getElementById("start_y").addEventListener('change', function (event) {
//     alert(event)
//     var elem = event.target;
// });


// 計算區塊
function PI(){
    return Math.PI
}

const TAN = Math.tan
const COS = Math.cos
const SIN = Math.sin

input_map = {
    "B3":"start_y",
    "B4":"d1_diameter",
    "B5":"r1_fillet",
    "B6":"a1_angle",
    "B7":"d2_diameter",
    "B8":"r2_fillet",
    "B9":"nose_radius",
}

function round_to_3_decimal_places(data){
    return Math.round(parseFloat(data) * 1000) / 1000
}

const elements = document.getElementsByClassName("input_val")
for (var i = 0; i < elements.length; i++) {
    elements[i].addEventListener('change', function (event) {

        
        Object.entries(input_map).forEach(([k, v]) => (window[k] = parseFloat(document.getElementById(v).value)));

        let E3 = document.getElementById("A_X1").innerHTML=round_to_3_decimal_places(2*B5/TAN(((90+B6)/2)*PI()/180))
        let G3 = document.getElementById("A_Y0").innerHTML=round_to_3_decimal_places(0)
        let E5 = document.getElementById("A_X2").innerHTML=round_to_3_decimal_places(2*(B5/TAN(((90+B6)/2)*PI()/180))*SIN(B6*PI()/180))
        let G5 = document.getElementById("A_Y1").innerHTML=round_to_3_decimal_places((B5/TAN(((90+B6)/2)*PI()/180))*COS(B6*PI()/180))
        let E7 = document.getElementById("A_X3").innerHTML=round_to_3_decimal_places(2*(TAN((B6/2)*PI()/180)*B8)*SIN(B6*PI()/180))
        let G7 = document.getElementById("A_Y2").innerHTML=round_to_3_decimal_places(TAN((B6/2)*PI()/180)*B8*COS(B6*PI()/180))
        let E9 = document.getElementById("A_X0").innerHTML=round_to_3_decimal_places(0)
        let G9 = document.getElementById("A_Y3").innerHTML=round_to_3_decimal_places(TAN((B6/2)*PI()/180)*B8)

        // 因為沒有雙向綁定要先計算
        let G23 = document.getElementById("C_arc").innerHTML=round_to_3_decimal_places(2*B9*SIN((B6/2)*PI()/180))

        let G13 = document.getElementById("B_arc").innerHTML=round_to_3_decimal_places(2*B9*SIN((B6/2)*PI()/180))
        let I13 = document.getElementById("B_X_offset1").innerHTML=round_to_3_decimal_places(2*G23*SIN((B6/2)*PI()/180))
        let K13 = document.getElementById("B_Z_offset1").innerHTML=round_to_3_decimal_places(B9-G23*COS((B6/2)*PI()/180))
        let G14 = document.getElementById("B_contour_offset").innerHTML=round_to_3_decimal_places((B9/COS(45*PI()/180)*COS((45-B6)*PI()/180))-B9)
        let I14 = document.getElementById("B_X_offset2").innerHTML=round_to_3_decimal_places(2*G14/COS(B6*PI()/180))
        let K14 = document.getElementById("B_Z_offset2").innerHTML=round_to_3_decimal_places(G14/SIN(B6*PI()/180))

        let C15 = document.getElementById("B_1_nX").innerHTML=round_to_3_decimal_places(B4-E3)
        let E15 = document.getElementById("B_1_nZ").innerHTML=round_to_3_decimal_places(B3)
        let G15 = document.getElementById("B_1_oX").innerHTML=round_to_3_decimal_places(B5==0 ? C15-I14: C15-(2*B9))
        let I15 = document.getElementById("B_1_oZ").innerHTML=round_to_3_decimal_places(E15)
        
        let C16 = document.getElementById("B_2_nX").innerHTML= B5==0 ? "無": round_to_3_decimal_places(B4+E5)
        let E16 = document.getElementById("B_2_nZ").innerHTML= B5==0 ? "無": round_to_3_decimal_places((B3+G5)*-1)
        let G16 = document.getElementById("B_2_oX").innerHTML= B5==0 ? "無": round_to_3_decimal_places(C16-I13)
        let I16 = document.getElementById("B_2_oZ").innerHTML= B5==0 ? "無": round_to_3_decimal_places(E16-K13)
        let K16 = document.getElementById("B_2_oR").innerHTML= B5==0 ? "無": round_to_3_decimal_places(B5+B9)

        let C17 = document.getElementById("B_3_nX").innerHTML= B5==0 ? "無": round_to_3_decimal_places(B7-E7)
        let E17 = document.getElementById("B_3_nZ").innerHTML= B5==0 ? "無": round_to_3_decimal_places(((((B7-B4)/2)/TAN(B6*PI()/180)-G7+B3)*-1))
        let G17 = document.getElementById("B_3_oX").innerHTML= B5==0 ? "無": round_to_3_decimal_places(C17-I13)
        let I17 = document.getElementById("B_3_oZ").innerHTML= B5==0 ? "無": round_to_3_decimal_places(E17-K13)

        let C18 = document.getElementById("B_4_nX").innerHTML= 13
        let E18 = document.getElementById("B_4_nZ").innerHTML=round_to_3_decimal_places(((((B7-B4)/2)/TAN(B6*PI()/180)+G9+B3)*-1))
        let G18 = document.getElementById("B_4_oX").innerHTML=round_to_3_decimal_places(C18)
        let I18 = document.getElementById("B_4_oZ").innerHTML=round_to_3_decimal_places(B5==0 ? E18-K14: E18-B9)
        let K18 = document.getElementById("B_4_oR").innerHTML= B5==0 ? "無": round_to_3_decimal_places(B8+B9)

        let B23 = document.getElementById("C_D1").innerHTML=round_to_3_decimal_places(22.85)
        let E23 = document.getElementById("C_D2").innerHTML=round_to_3_decimal_places(19.35)
        
        let I23 = document.getElementById("C_X_offset").innerHTML=round_to_3_decimal_places(2*G23*SIN((B6/2)*PI()/180))
        let K23 = document.getElementById("C_Z_offset").innerHTML=round_to_3_decimal_places(B9+G23*COS((B6/2)*PI()/180))
        let B24 = document.getElementById("C_L1").innerHTML=round_to_3_decimal_places(1.75)

        let C25 = document.getElementById("C_1_nX").innerHTML=round_to_3_decimal_places(B23)
        let E25 = document.getElementById("C_1_nZ").innerHTML=round_to_3_decimal_places((B24-G9)*-1)
        let G25 = document.getElementById("C_1_oX").innerHTML=round_to_3_decimal_places(C25)
        let I25 = document.getElementById("C_1_oZ").innerHTML=round_to_3_decimal_places(E25-B9)
        
        let C26 = document.getElementById("C_2_nX").innerHTML=round_to_3_decimal_places(B23-E7)
        let E26 = document.getElementById("C_2_nZ").innerHTML=round_to_3_decimal_places((B24+G7)*-1)
        let G26 = document.getElementById("C_2_oX").innerHTML=round_to_3_decimal_places(C26-I13)
        let I26 = document.getElementById("C_2_oZ").innerHTML=round_to_3_decimal_places(E26-K23)
        let K26 = document.getElementById("C_2_oR").innerHTML=round_to_3_decimal_places(B5+B9)

    });
}



</script>
</html>